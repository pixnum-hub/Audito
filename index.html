<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéµ Audito - Mobile-first Neomorphic Music Player</title>
  <style>
    :root {
      --bg: #111;
      --panel: #1a1a1a;
      --panel-inset: #1b1b1b;
      --accent: #00e0ff;
      --text: #eee;
    }

    * { box-sizing: border-box; }

    body {
      background: var(--bg);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .app-frame {
      width: 95%;
      max-width: 460px;
      background: var(--panel);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 12px 12px 28px rgba(0,0,0,0.7),
                  -8px -8px 20px rgba(255,255,255,0.02);
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 16px auto;
    }

    .header-row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .header-row h2 { margin:0; font-size:18px; color:var(--accent); }

    input[type=file] { color:var(--text); }

    #mediaContainer { width:100%; border-radius:10px; overflow:hidden; background:#000; }

    canvas { width:100%; height:100px; border-radius:12px; background:#0b0b0b;
      box-shadow: inset 6px 6px 12px rgba(0,0,0,0.6); display:block; }

    .seek-bar { width:100%; margin-top:6px; }
    .seek-bar input[type=range] {
      width:100%; -webkit-appearance:none; height:8px;
      border-radius:8px; background:linear-gradient(90deg,#222,#181818);
      box-shadow: inset 4px 4px 8px rgba(0,0,0,0.6);
    }
    .seek-bar input[type=range]::-webkit-slider-thumb {
      -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
      background:var(--accent); box-shadow:0 0 12px rgba(0,224,255,0.6);
    }

    .controls {
      display:flex; flex-wrap:wrap; justify-content:center;
      gap:8px; align-items:center; margin-top:6px;
    }
    .controls button {
      background: var(--panel-inset); color: var(--text);
      border: none; padding: 8px 12px; border-radius: 12px;
      box-shadow: 6px 6px 12px rgba(0,0,0,0.6),
                  -6px -6px 12px rgba(255,255,255,0.02);
      cursor:pointer; font-size:14px;
    }
    .controls button:active {
      box-shadow: inset 6px 6px 12px rgba(0,0,0,0.6),
                  inset -6px -6px 12px rgba(255,255,255,0.02);
      transform:scale(.98);
    }
    .controls select {
      background: var(--panel-inset); padding:8px; border-radius:10px;
      box-shadow: inset 4px 4px 8px rgba(0,0,0,0.6); border:none; color:var(--text);
    }

    .volume-control {
      display:flex; align-items:center; gap:10px;
      background:var(--panel-inset); padding:8px; border-radius:12px;
      box-shadow: inset 6px 6px 12px rgba(0,0,0,0.6),
                  inset -6px -6px 12px rgba(255,255,255,0.02);
    }
    .volume-control input[type=range]{
      width:80%; -webkit-appearance:none; height:6px; background:transparent;
    }
    .volume-control input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
      background:var(--accent); box-shadow:0 0 12px rgba(0,224,255,0.6);
      cursor:pointer;
    }

    /* --- EQ: now non-scrollable fixed layout --- */
    .eq {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 8px;
      height: 150px;
      padding: 8px 6px;
      border-radius: 14px;
      background: var(--panel-inset);
      box-shadow: inset 8px 8px 14px rgba(0,0,0,0.6),
                  inset -8px -8px 14px rgba(255,255,255,0.02);
      overflow: hidden; /* no scrollbars */
    }

    .eq input[type=range] {
      writing-mode: bt-lr;
      -webkit-appearance: slider-vertical;
      width: 26px;
      height: 120px;
      border-radius: 12px;
      background: #222;
      outline: none;
      box-shadow: 4px 4px 8px rgba(0,0,0,0.6),
                  -4px -4px 8px rgba(255,255,255,0.02);
    }

    .eq input[type=range]::-webkit-slider-thumb {
      -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
      transition: transform .14s;
    }
    .eq input[type=range]:hover::-webkit-slider-thumb { transform:scale(1.2); }

    /* per-band neon thumb colors */
    .eq input:nth-child(1)::-webkit-slider-thumb{ background:#ff3b3b; box-shadow:0 0 10px #ff3b3b; }
    .eq input:nth-child(2)::-webkit-slider-thumb{ background:#ff7b00; box-shadow:0 0 10px #ff7b00; }
    .eq input:nth-child(3)::-webkit-slider-thumb{ background:#ffb300; box-shadow:0 0 10px #ffb300; }
    .eq input:nth-child(4)::-webkit-slider-thumb{ background:#00ff80; box-shadow:0 0 10px #00ff80; }
    .eq input:nth-child(5)::-webkit-slider-thumb{ background:#00d5ff; box-shadow:0 0 10px #00d5ff; }
    .eq input:nth-child(6)::-webkit-slider-thumb{ background:#007bff; box-shadow:0 0 10px #007bff; }
    .eq input:nth-child(7)::-webkit-slider-thumb{ background:#c800ff; box-shadow:0 0 10px #c800ff; }
    .eq input:nth-child(8)::-webkit-slider-thumb{ background:#ff00ff; box-shadow:0 0 10px #ff00ff; }
    .eq input:nth-child(9)::-webkit-slider-thumb{ background:#ff5ce2; box-shadow:0 0 10px #ff5ce2; }
    .eq input:nth-child(10)::-webkit-slider-thumb{ background:#00ffff; box-shadow:0 0 10px #00ffff; }
    .eq input:nth-child(11)::-webkit-slider-thumb{ background:#ffff00; box-shadow:0 0 10px #ffff00; }

    .playlist {
      width:100%; max-height:120px; overflow-y:auto; padding:8px;
      border-radius:12px; background:#0f0f0f;
      box-shadow: inset 6px 6px 12px rgba(0,0,0,0.6); color:#fff;
    }
    .playlist div{ padding:8px; border-radius:8px; cursor:pointer; }
    .playlist div:hover{ background:#222; }

    .debug-log {
      width:100%; height:72px; border-radius:10px; padding:8px;
      background:#000; color:#00ffcc;
      box-shadow: inset 4px 4px 8px rgba(0,0,0,0.6);
      overflow:auto; font-size:12px;
    }

    @media (max-width:420px) {
      .app-frame { padding:10px; }
      .eq { height:130px; gap:6px; }
      .eq input[type=range]{ width:22px; height:100px; }
      canvas { height:80px; }
      .controls button{ padding:6px 8px; font-size:12px; }
    }
  </style>
</head>
<body>
  <div class="app-frame" id="app">
    <div class="header-row">
      <h2>üéµ Audito</h2>
      <input type="file" id="fileInput" multiple accept="audio/*,video/*" />
    </div>

    <div id="mediaContainer"></div>
    <div class="seek-bar" id="seekBarContainer"></div>
    <canvas id="spectrum"></canvas>

    <div class="controls">
      <button id="prev">‚èÆ</button>
      <button id="play">‚ñ∂Ô∏è</button>
      <button id="pause">‚è∏</button>
      <button id="stop">‚èπ</button>
      <button id="next">‚è≠</button>
      <button id="loop">Loop: Off</button>

      <select id="spectrumPreset">
        <option value="rainbow">Rainbow</option>
        <option value="fire">Fire</option>
        <option value="ocean">Ocean</option>
        <option value="neon">Neon</option>
      </select>
    </div>

    <div class="volume-control">
      <label>üîä</label>
      <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.3">
    </div>

    <!-- Non-scrollable 11-band EQ -->
    <div class="eq" id="eq">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="60">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="170">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="350">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="1000">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="3500">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="6000">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="10000">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="12000">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="15000">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="18000">
      <input type="range" min="-36" max="36" value="0" step="1" data-band="20000">
    </div>

    <div class="playlist" id="playlist"></div>
    <div class="debug-log" id="debugLog"></div>

    <div style="text-align:center; color:#bbb;">
      <small>¬© Manik Roy 2025. All Rights Reserved.</small>
    </div>
  </div>

  <script>
    /* Same JS as before (EQ resets, volume persists, 4 visualizer presets) */
    let audioContext, analyser, sourceNode, masterGain, filters = [];
    let files = [], currentFileIndex = 0, currentMedia = null, loopMode = 0, audioContextStarted = false;

    const fileInput = document.getElementById('fileInput');
    const playlist = document.getElementById('playlist');
    const debugLog = document.getElementById('debugLog');
    const loopBtn = document.getElementById('loop');
    const volumeSlider = document.getElementById('volumeSlider');
    const spectrumPreset = document.getElementById('spectrumPreset');

    function log(msg){ debugLog.innerHTML += msg + '<br>'; debugLog.scrollTop = debugLog.scrollHeight; }

    function initAudioContext(){
      if(!audioContext){
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 512;
        masterGain = audioContext.createGain();
        masterGain.gain.value = volumeSlider.value;
        masterGain.connect(analyser);
        analyser.connect(audioContext.destination);
        setupEQ();
      }
    }

    document.body.addEventListener('click', ()=> {
      if(!audioContextStarted){
        audioContextStarted = true;
        initAudioContext();
        if(audioContext.state === 'suspended') audioContext.resume();
      }
    }, { once:true });

    volumeSlider.oninput = ()=>{
      if(currentMedia) currentMedia.volume = volumeSlider.value;
      if(masterGain) masterGain.gain.value = volumeSlider.value;
      localStorage.setItem('audito_volume', volumeSlider.value);
    };

    function setupEQ(){
      const eqSliders = document.querySelectorAll('.eq input');
      filters = [];
      eqSliders.forEach(slider=>{
        const freq = parseFloat(slider.dataset.band);
        const f = audioContext.createBiquadFilter();
        f.type='peaking'; f.frequency.value=freq;
        f.Q.value = freq<100?1.2:freq<1000?1:0.5;
        f.gain.value=parseFloat(slider.value);
        slider.oninput=e=>{ f.gain.value=parseFloat(e.target.value); };
        filters.push(f);
      });
      for(let i=0;i<filters.length-1;i++) filters[i].connect(filters[i+1]);
      if(filters.length) filters[filters.length-1].connect(masterGain);
    }

    function resetEQDefaults(){
      document.querySelectorAll('.eq input').forEach(s=>{
        s.value=0; localStorage.removeItem('audito_eq_'+s.dataset.band);
      });
    }

    function createMediaElement(file){
      if(currentMedia){ try{currentMedia.pause();currentMedia.remove();}catch{} if(sourceNode)sourceNode.disconnect(); }
      const url = URL.createObjectURL(file);
      if(file.type.startsWith('video')){
        currentMedia=document.createElement('video');
        currentMedia.src=url; currentMedia.controls=true; currentMedia.style.width='100%';
      } else {
        currentMedia=document.createElement('audio');
        currentMedia.src=url; currentMedia.controls=true; currentMedia.style.width='100%';
        if(!audioContextStarted){ initAudioContext(); audioContextStarted=true; }
        sourceNode=audioContext.createMediaElementSource(currentMedia);
        if(filters.length>0) sourceNode.connect(filters[0]); else sourceNode.connect(masterGain);
      }
      currentMedia.volume=volumeSlider.value;
      document.getElementById('mediaContainer').innerHTML='';
      document.getElementById('mediaContainer').appendChild(currentMedia);
      currentMedia.play();
      currentMedia.onended=handleEnd;
      currentMedia.ontimeupdate=()=>{ if(currentMedia.duration) seekBar.value=(currentMedia.currentTime/currentMedia.duration)*100; };
    }

    fileInput.onchange=e=>{
      files=Array.from(e.target.files);
      playlist.innerHTML='';
      files.forEach((f,i)=>{
        const d=document.createElement('div');
        d.textContent=f.name;
        d.onclick=()=>loadFile(i);
        playlist.appendChild(d);
      });
      if(files.length) loadFile(0);
    };

    function loadFile(i){ currentFileIndex=i; createMediaElement(files[i]); }
    function play(){ currentMedia?.play(); }
    function pause(){ currentMedia?.pause(); }
    function stop(){ if(currentMedia){ currentMedia.pause(); currentMedia.currentTime=0; } }
    function next(){ if(files.length) loadFile((currentFileIndex+1)%files.length); }
    function prev(){ if(files.length) loadFile((currentFileIndex-1+files.length)%files.length); }

    document.getElementById('play').onclick=play;
    document.getElementById('pause').onclick=pause;
    document.getElementById('stop').onclick=stop;
    document.getElementById('next').onclick=next;
    document.getElementById('prev').onclick=prev;
    loopBtn.onclick=()=>{ loopMode=(loopMode+1)%3; loopBtn.textContent='Loop: '+(loopMode===0?'Off':loopMode===1?'One':'All'); };
    function handleEnd(){ if(loopMode===1){ currentMedia.currentTime=0; play(); } else if(loopMode===2) next(); }

    const seekBar=document.createElement('input');
    seekBar.type='range'; seekBar.min=0; seekBar.max=100; seekBar.step=0.1;
    document.getElementById('seekBarContainer').appendChild(seekBar);
    seekBar.oninput=()=>{ if(currentMedia) currentMedia.currentTime=(seekBar.value/100)*currentMedia.duration; };

    function animateSpectrum(){
      requestAnimationFrame(animateSpectrum);
      if(!analyser)return;
      const canvas=document.getElementById('spectrum');
      const ctx=canvas.getContext('2d');
      const data=new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteFrequencyData(data);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const w=canvas.width/data.length;
      const preset=spectrumPreset.value;
      for(let i=0;i<data.length;i++){
        const v=data[i];
        let color;
        switch(preset){
          case 'fire': color=`rgb(${v+80},${v/3},0)`;break;
          case 'ocean': color=`rgb(0,${v/2},${v+50})`;break;
          case 'neon': color=`rgb(${v},0,${v+100})`;break;
          default: color=`hsl(${i/data.length*360},100%,50%)`; // rainbow
        }
        ctx.fillStyle=color;
        ctx.fillRect(i*w,canvas.height-v/1.5,w-1,v/1.5);
      }
    }
    animateSpectrum();

    window.addEventListener('load',()=>{
      resetEQDefaults();
      const savedVol=localStorage.getItem('audito_volume');
      if(savedVol){ volumeSlider.value=savedVol; if(masterGain) masterGain.gain.value=savedVol; }
    });
  </script>
</body>
</html>
